<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Stock Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* -------------------------------------- */
/*            THEME VARIABLES             */
/* -------------------------------------- */
:root {
  --bg: #0d1117;
  --card-bg: rgba(255,255,255,0.06);
  --border: rgba(255,255,255,0.15);
  --text: #e6edf3;
  --highlight: #60a5fa;
  --shadow: rgba(96,165,250,0.3);
}

/* Light Theme */
.light {
  --bg: #f7f9fc;
  --card-bg: white;
  --border: rgba(0,0,0,0.1);
  --text: #1f2937;
  --highlight: #2563eb;
  --shadow: rgba(37,99,235,0.25);
}

/* -------------------------------------- */
/*         GLOBAL RESET + BODY            */
/* -------------------------------------- */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: "Poppins", sans-serif;
  background: var(--bg);
  color: var(--text);
  padding: 20px;
  transition: 0.3s ease-in-out;
}

/* -------------------------------------- */
/*            HEADER & TOGGLE             */
/* -------------------------------------- */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

h2 {
  font-size: 28px;
  color: var(--highlight);
  margin-bottom: 15px;
  text-shadow: 0 0 8px var(--shadow);
}

/* -------------------------------------- */
/*      PREMIUM MINIMAL THEME TOGGLE      */
/* -------------------------------------- */

.toggle-switch {
  width: 55px;
  height: 28px;
  background: var(--card-bg);
  border-radius: 50px;
  border: 1px solid var(--border);
  position: relative;
  cursor: pointer;
  transition: background 0.4s ease;
  display: flex;
  align-items: center;
  padding: 0 4px;
  box-shadow: inset 0 0 10px var(--shadow);
}

.toggle-switch:hover {
  box-shadow: 0 0 14px var(--shadow);
}

/* The knob */
.toggle-switch .toggle-knob {
  width: 22px;
  height: 22px;
  background: var(--highlight);
  border-radius: 50%;
  position: absolute;
  left: 3px;
  transition: all 0.3s cubic-bezier(0.25, 1.25, 0.5, 1.25);
  box-shadow: 0 3px 12px var(--shadow);
}

/* Light mode position */
body.light .toggle-switch .toggle-knob {
  transform: translateX(26px);
  background: var(--highlight);
}
w


/* -------------------------------------- */
/*            LAYOUT WRAPPER              */
/* -------------------------------------- */
.wrapper {
  display: flex;
  gap: 20px;
}

/* -------------------------------------- */
/*               SIDEBAR                  */
/* -------------------------------------- */
#left {
  width: 260px;
  padding: 18px;
  background: var(--card-bg);
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: 0 0 15px var(--shadow);
  animation: slide 0.6s ease-out;
}

@keyframes slide {
  from { transform: translateX(-20px); opacity: 0; }
  to   { transform: translateX(0); opacity: 1; }
}

#searchBox {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--text);
  margin-bottom: 12px;
  outline: none;
}

#companies {
  list-style: none;
  max-height: 420px;
  overflow-y: auto;
}

#companies li {
  background: var(--card-bg);
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border: 1px solid transparent;
  transition: 0.3s;
}

#companies li:hover {
  border-color: var(--highlight);
  box-shadow: 0 0 12px var(--shadow);
  transform: translateX(5px);
}

/* -------------------------------------- */
/*               MAIN PANEL               */
/* -------------------------------------- */
#main {
  flex: 1;
    padding: 20px;
  background: var(--card-bg);
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: 0 0 15px var(--shadow);
}

label {
  font-size: 16px;
}

select {
  padding: 6px 10px;
  background: var(--bg);
  color: var(--text);
  border-radius: 8px;
  border: 1px solid var(--border);
}

/* -------------------------------------- */
/*                 CHART                  */
/* -------------------------------------- */
#chart {
  margin-top: 20px;
  padding: 15px;
  border-radius: 12px;
  background: var(--bg);
  border: 1px solid var(--border);
  box-shadow: 0 0 15px var(--shadow);
}

/* Tooltip Card */
.tooltip-card {
  margin-top: 20px;
  padding: 18px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  font-size: 14px;
  box-shadow: 0 0 20px var(--shadow);
}

/* -------------------------------------- */
/*             RESPONSIVE MODE            */
/* -------------------------------------- */
/* Desktop view: side-by-side */
@media (min-width: 901px) {
  .wrapper {
    display: flex;
    flex-direction: row;
    gap: 20px;
  }

  #left {
    min-width: 260px;
  }
}

/* Mobile view: stack */
@media (max-width: 900px) {
  .wrapper {
    display: flex;
    flex-direction: column;
  }

  #main {
    margin-left: 0 !important;
  }
}


</style>
</head>

<body>
<div class="header">
  <h2>Stock Dashboard</h2>
  <button id="themeToggle" class="toggle-switch">
  <span class="toggle-knob"></span>
</button>

</div>

<div class="wrapper">

  <!-- SIDEBAR -->
  <div id="left">
    <input id="searchBox" placeholder="Search company..." />
    <ul id="companies"></ul>
  </div>

  <!-- MAIN PANEL -->
  <div id="main">
    <label>Days:
      <select id="days">
        <option>30</option>
        <option>90</option>
        <option>180</option>
      </select>
    </label>

    <canvas id="chart" height="220"></canvas>

    <div id="summary" class="tooltip-card"></div>
  </div>

</div>

<script>
const apiBase = "/StockDashBoard/api";
let chart;

/* ---------------- THEME TOGGLE ---------------- */

// Load saved theme

// Load saved theme
if (localStorage.getItem("theme") === "light") {
  document.body.classList.add("light");
}

// Toggle
document.getElementById("themeToggle").onclick = () => {
  document.body.classList.toggle("light");

  if (document.body.classList.contains("light")) {
    localStorage.setItem("theme", "light");
  } else {
    localStorage.setItem("theme", "dark");
  }
};




/* ---------------- LOAD COMPANIES ---------------- */
async function loadCompanies() {
  const res = await fetch(apiBase + "/companies");
  const data = await res.json();
  window.allCompanies = data;
  renderCompanyList(data);
}

/* ---------------- SEARCH FILTER ---------------- */
document.getElementById("searchBox").addEventListener("input", (e) => {
  const q = e.target.value.toLowerCase();
  const filtered = window.allCompanies.filter(c =>
    c.symbol.toLowerCase().includes(q) ||
    (c.name || "").toLowerCase().includes(q)
  );
  renderCompanyList(filtered);
});

/* Render List */
function renderCompanyList(list) {
  const ul = document.getElementById("companies");
  ul.innerHTML = "";
  list.forEach(c => {
    const li = document.createElement("li");
    li.textContent = `${c.symbol} - ${c.name || ""}`;
    li.onclick = () => loadData(c.symbol);
    ul.appendChild(li);
  });
}

/* ---------------- LOAD DATA + UPDATE CHART ----------- */
async function loadData(symbol) {
  const days = document.getElementById("days").value;

  const res = await fetch(`${apiBase}/data/${symbol}?days=${days}`);
  const arr = await res.json();

  const labels = arr.map(x => x.date);
  const prices = arr.map(x => x.closePrice);

  if (!chart) {
    const ctx = document.getElementById("chart").getContext("2d");
    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: symbol + " Price",
          data: prices,
          borderColor: "#60a5fa",
          backgroundColor: "rgba(96,165,250,0.25)",
          fill: true,
          tension: 0.4
        }]
      }
    });
  } else {
    chart.data.labels = labels;
    chart.data.datasets[0].data = prices;
    chart.data.datasets[0].label = symbol + " Price";
    chart.update();
  }

  // LOAD SUMMARY CARD
  const sres = await fetch(apiBase + "/summary/" + symbol);
  const summary = await sres.json();
  showSummary(summary);
}

/* ---------------- SUMMARY CARD DISPLAY ---------------- */
function showSummary(s) {
  const box = document.getElementById("summary");
  if (!s || Object.keys(s).length === 0) {
    box.innerHTML = "<i>No summary available</i>";
    return;
  }

  box.innerHTML = `
    <b>52 Week High:</b> ${s["52WeekHigh"]}<br>
    <b>52 Week Low:</b> ${s["52WeekLow"]}<br>
    <b>Avg Close:</b> ${s["avgClose"]}<br>
    <b>Volatility:</b> ${s["volatility"]}<br>
  `;
}

/* Auto-load first company on day change */
document.getElementById("days").onchange = () => {
  const first = document.querySelector("#companies li");
  if (first) first.click();
};

loadCompanies();
</script>

</body>
</html>
 